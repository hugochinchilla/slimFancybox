/*
	Slimfancybox v1.71 - Yet another lightweight [lightbox|fancybox] clone
	(c) 2010 Hugo Chinchilla <http://www.hugochinchilla.net>
	MIT-style license.
	
	Based on slimbox code by:
	Christophe Beyls <http://www.digitalia.be>
*/
var Slimbox=(function(){var N=window,r=Browser.Engine.trident4,z,i,O=-1,s,C,M,A,E,U,w,J=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,a,f,q={},y=new Image(),S=new Image(),Q,c,j,u,R,g,P,d,I,T,D,k,e,K;N.addEvent("domready",function(){$(document.body).adopt($$(Q=new Element("div",{id:"lbOverlay",events:{click:L}}),c=new Element("div",{id:"lbCenter"}),P=new Element("div",{id:"lbBottomContainer"})).setStyle("display","none"));closeBtn=new Element("a",{id:"lbCloseBtn",href:"#",events:{click:L}}).injectInside(c);j=new Element("div",{id:"lbImage"}).injectInside(c);u=new Element("div",{styles:{position:"relative"}}).injectInside(j);d=new Element("div",{id:"lbBottom"}).injectInside(P).adopt(I=new Element("div",{id:"lbCaption"}),T=new Element("div",{id:"lbNumber"}),new Element("div",{styles:{clear:"both"}}))});function H(){var V=N.getScroll(),W=N.getSize();$$(c,P).setStyle("left",V.x+(W.x/2));if(A){Q.setStyles({left:V.x,top:V.y,width:W.x,height:W.y})}}function o(V){["object",r?"select":"embed"].forEach(function(X){Array.forEach(document.getElementsByTagName(X),function(Y){if(V){Y._slimbox=Y.style.visibility}Y.style.visibility=V?"hidden":Y._slimbox})});Q.style.display=V?"":"none";var W=V?"addEvent":"removeEvent";N[W]("scroll",H)[W]("resize",H);document[W]("keydown",t)}function t(W){var V=W.code;return z.closeKeys.contains(V)?L():z.nextKeys.contains(V)?h():z.previousKeys.contains(V)?G():false}function G(){return b(C)}function h(){return b(M)}function b(V){if(V>=0){O=V;s=i[V][0];C=(O||(z.loop?i.length:0))-1;M=((O+1)%i.length)||(z.loop?0:-1);v();c.className="lbLoading";q=new Image();q.onload=function(){f=q.height;a=q.width;m()};q.src=s}return false}function n(){j.setStyle("backgroundImage","url("+s+")");I.set("html",i[O][1]||"");T.set("html",(((i.length>1)&&z.counterText)||"").replace(/{x}/,O+1).replace(/{y}/,i.length));if(C>=0){y.src=i[C][0]}if(M>=0){S.src=i[M][0]}}function m(W){if(!$defined(W)){W=true}c.className="";e.set(0);j.setStyle("display","");u.setStyle("width",a);$$(u,R,g).setStyle("height",f);if(W){n()}U=j.offsetWidth;w=j.offsetHeight;var Y=Math.max(0,E-(w/2)),V=0,X;if(c.offsetHeight!=w){V=k.start({height:w,top:Y})}if(c.offsetWidth!=U){V=k.start({width:U,marginLeft:-U/2})}X=function(){if(W){P.setStyles({width:U,top:Y+w,marginLeft:-U/2,visibility:"hidden",display:""})}e.start(1)};if(V){k.chain(X)}else{X()}}function l(){if(C>=0){R.style.display=""}if(M>=0){g.style.display=""}K.set(-d.offsetHeight).start(0);P.style.visibility=""}function v(){q.onload=$empty;q.src=y.src=S.src=s;k.cancel();e.cancel();K.cancel();$$(R,g,j,P).setStyle("display","none")}function L(){if(O>=0){j.setStyle("backgroundImage","");u.empty();v();O=C=M=-1;c.style.display="none";D.cancel().chain(o).start(0)}return false}function p(W,V){u.adopt(R=new Element("a",{id:"lbPrevLink",href:"#",events:{click:G}}),g=new Element("a",{id:"lbNextLink",href:"#",events:{click:h}}));z.loop=z.loop&&(i.length>1);return b(V)}function B(V){v();c.className="lbLoading";a=z.frameWidth;f=z.frameHeight;q=new Element("iframe",{id:"lbContent",name:"fancy_iframe"+Math.round(Math.random()*1000),frameborder:"0",hspace:"0",src:V,width:a,height:f}).addEvent("load",function(){m(false)}).injectInside(u);O=0;return false}function F(){v();c.className="lbLoading";var W=window.location.href.split("#")[0];W=href.replace(W,"");W=W.substr(W.indexOf("#")+1);W=$(W);var V=W.getStyle("display");W.setStyle("display","");f=W.getHeight();a=W.getWidth();W.setStyle("display",V);W.clone(true,true).injectInside(u);j.getElements("*").setStyles({visibility:"visible",display:""});O=0;m(false);return false}function x(V){v();c.className="lbLoading";a=z.frameWidth;f=z.frameHeight;u.set("html",V);O=0;m(false);return false}Element.implement({slimbox:function(V,W){$$(this).slimbox(V,W);return this}});Elements.implement({slimbox:function(V,Y,X){Y=Y||function(Z){return[Z.href,Z.title,Z]};X=X||function(){return true};var W=this;W.removeEvents("click").addEvent("click",function(){var Z=W.filter(X,this);return Slimbox.open(Z.map(Y),Z.indexOf(this),V)});return W}});return{open:function(X,W,V){z=$extend({loop:false,overlayOpacity:0.8,overlayFadeDuration:400,resizeDuration:400,resizeTransition:false,initialWidth:250,initialHeight:250,frameWidth:800,frameHeight:600,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},V||{});D=new Fx.Tween(Q,{property:"opacity",duration:z.overlayFadeDuration});k=new Fx.Morph(c,$extend({duration:z.resizeDuration,link:"chain"},z.resizeTransition?{transition:z.resizeTransition}:{}));e=new Fx.Tween(j,{property:"opacity",duration:z.imageFadeDuration,onComplete:l});K=new Fx.Tween(d,{property:"margin-top",duration:z.captionAnimationDuration});if(typeof X=="string"){X=[[X,W,j]];W=0}E=N.getScrollTop()+(N.getHeight()/2);U=z.initialWidth;w=z.initialHeight;c.setStyles({top:Math.max(0,E-(w/2)),width:U,height:w,marginLeft:-U/2,display:""});A=r||(Q.currentStyle&&(Q.currentStyle.position!="fixed"));if(A){Q.style.position="absolute"}D.set(0).start(z.overlayOpacity);H();o(1);i=X;z.loop=z.loop&&(i.length>1);elem=X[W][2];href=X[W][0];if(href.match(J)){return p(X,W,z)}else{if(href.match(/#/)){return F(href)}else{if(href.match("iframe")||elem.className.indexOf("iframe")>=0){return B(href)}else{return x(href)}}}}}})();

// AUTOLOAD CODE BLOCK (MAY BE CHANGED OR REMOVED)
Slimbox.scanPage = function() {
	$$("a").filter(function(el) {
		return el.rel && el.rel.test(/^lightbox/i);
	}).slimbox({
		/* Put custom options here */
		loop: true
	}, null, function(el) {
		return (this == el) || ((this.rel.length > 8) && (this.rel == el.rel));
	});
};
if (!/android|iphone|ipod|series60|symbian|windows ce|blackberry/i.test(navigator.userAgent)) {
	window.addEvent("domready", Slimbox.scanPage);
}